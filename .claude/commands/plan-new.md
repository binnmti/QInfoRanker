---
description: 新しい実装プランを作成する
---

# 新規プラン作成

ユーザーの要望を元に、構造化された実装プランを作成します。

## 使い方

```
/plan-new
```

引数なしで実行し、対話的に要望を聞き取る。

## 実行手順

### Step 1: 要望の収集（対話形式）

**固定的な質問をせず、ユーザーが自由に要望を伝える形式で進める。**

1. シンプルに「何を実装したいですか？」と聞く
2. ユーザーが要望を伝える
3. 必要に応じて調査を行う（調査する場合は「調査してからプランに反映します」と宣言）
4. タスクリストに追加して表示
5. 「他にやりたいことはありますか？」と聞く
6. 全部揃うまで繰り返し

**タスクリストの表示形式：**

```markdown
## 現在のタスクリスト

| # | タスク | 概要 |
|---|--------|------|
| 1 | {タスク名} | {簡潔な説明} |
| 2 | {タスク名} | {簡潔な説明} |
| ... | ... | ... |

---

他にやりたいことはありますか？全部揃ったらプランファイルを作成します。
```

### Step 2: 調査（必要な場合のみ）

調査が必要な場合は：

1. **「調査してからプランに反映します」と宣言**
2. `Task` ツール（Explore エージェント）で調査
3. 調査結果を報告
4. タスクリストに追加するか確認

**調査だけで終わらせない。必ずタスクリストの更新まで行う。**

### Step 3: プランファイルの作成

ユーザーから「全部揃った」「次に進んで」などのゴーサインが出たら：

1. ブランチ名を決定（複数タスクの場合は「ごった煮」的な名前でもOK、ユニークであれば良い）
2. 以下のフォルダ構造を作成：

```
doc/plans/{branch-name}/
├── README.md           # プラン概要
├── RETROSPECTIVE.md    # 振り返り用（テンプレート）
├── task-01-xxx.md      # タスク1
├── task-02-xxx.md      # タスク2
└── ...
```

### Step 4: README.md の作成

```markdown
# 実装プラン: {プラン名}

## 概要

{プランの目的と背景を1-2段落で}

## ブランチ

```
{branch-name}
```

## 実行順序

```
task-01 → task-02 → task-03 → ...
```

{依存関係や並列実行の可否について}

## タスク一覧

| # | ファイル | 内容 | 依存 | ステータス |
|---|---------|------|------|-----------|
| 01 | task-01-xxx.md | {概要} | なし | pending |
| 02 | task-02-xxx.md | {概要} | 01 | pending |
| ... | ... | ... | ... | ... |

## コミット規約

各タスク完了時:
```
<type>: <description>

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

## 進捗

- [ ] ブランチ作成
- [ ] task-01 完了
- [ ] task-02 完了
- [ ] ...
- [ ] 全テスト通過
- [ ] mainへマージ
```

### Step 5: タスクファイルの作成

各タスクファイルは以下のテンプレートに従う：

```markdown
# タスク{番号}: {タスク名}

## 目的

{このタスクで何を達成するか}

## 背景

{なぜこのタスクが必要か、どういう文脈か}
{調査結果があればここに含める}

## 対象ファイル

- `src/xxx.cs` - {変更内容}
- `src/yyy.cs` - {変更内容}

## 実装内容

- [ ] {具体的な実装項目1}
- [ ] {具体的な実装項目2}
- [ ] {具体的な実装項目3}

## テスト

- [ ] {テスト項目1}
- [ ] {テスト項目2}

## 完了条件

- {条件1}
- {条件2}
- 既存テストが通る

## 参考情報

- {参考になるファイルやドキュメント}

---

## 実行結果

<!-- /plan-run 実行時に自動追記される -->
```

### Step 6: RETROSPECTIVE.md の作成

```markdown
# 振り返り: {プラン名}

このファイルはプラン実行中に発生した問題点・改善点を記録する。
タスク実行後、気づいた点があれば随時追記すること。

---

## 問題点・課題

<!-- /plan-run 実行時に自動追記される -->

---

## 改善アイデア

### プランファイル関連

-

### サブエージェント関連

-

### CLAUDE.md関連

-

---

## 根本的な改善提案

<!-- LESSONS_LEARNED.md に昇格させるべき重要な学びをここに記録 -->

---

## 良かった点

-
```

### Step 7: 確認とブランチ作成

1. 作成したプランをユーザーに提示
2. 修正があれば反映
3. 承認されたら Git ブランチを作成

```bash
git checkout -b {branch-name}
```

## 出力形式

プラン作成完了後：

```
## プラン作成完了

- プラン名: {プラン名}
- ブランチ: {branch-name}
- タスク数: N件
- 場所: doc/plans/{branch-name}/

### タスク一覧
1. {task-01の概要}
2. {task-02の概要}
...

次のステップ:
- `/plan-run doc/plans/{branch-name}` でタスクを順次実行
- または手動で各タスクを実行
```

## 命名規約

- **ブランチ名**: `feature/{YYYY-MM}-{短い説明}` または `fix/{issue番号}-{短い説明}`
  - 複数の無関係なタスクがある場合は `feature/{YYYY-MM}-improvements` など包括的な名前でもOK
  - ユニークであることが重要
- **タスクファイル**: `task-{番号2桁}-{kebab-case名}.md`
- **タスク番号**: 01から連番

## 注意事項

- タスクは小さく分割する（1タスク = 1コミット程度）
- 依存関係を明確にし、並列実行可能なものは明記
- テスト項目を必ず含める
- 完了条件を具体的に書く
- **調査を行う場合は必ず宣言してから実行する**
- **調査だけで終わらせず、タスクリストへの追加まで行う**
- **全ての要望を聞き終わってからプランファイルを作成する**
