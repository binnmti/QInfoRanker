---
description: 新しい実装プランを作成する
---

# 新規プラン作成

ユーザーの要望を元に、構造化された実装プランを作成します。

## 使い方

```
/plan-new ユーザー認証機能の追加
```

または引数なしで実行し、対話的に要望を聞き取る。

## 実行手順

### Step 1: 要望のヒアリング

ユーザーから以下を聞き取る（AskUserQuestion を使用）：

1. **目的**: 何を実現したいか
2. **スコープ**: どこまでやるか（MVP or フル機能）
3. **制約**: 使用技術、期限、避けるべきこと
4. **優先度**: 複数機能がある場合の優先順位

### Step 2: 既存コードの調査

`Task` ツール（Explore エージェント）で以下を調査：

- 関連する既存コード
- 影響を受けるファイル
- 既存のパターン・規約

### Step 3: プラン構造の作成

以下のフォルダ構造を作成：

```
doc/plans/{branch-name}/
├── README.md           # プラン概要
├── RETROSPECTIVE.md    # 振り返り用（テンプレート）
├── task-01-xxx.md      # タスク1
├── task-02-xxx.md      # タスク2
└── ...
```

### Step 4: README.md の作成

```markdown
# 実装プラン: {プラン名}

## 概要

{プランの目的と背景を1-2段落で}

## ブランチ

```
{branch-name}
```

## 実行順序

```
task-01 → task-02 → task-03 → ...
```

{依存関係や並列実行の可否について}

## タスク一覧

| # | ファイル | 内容 | 依存 | ステータス |
|---|---------|------|------|-----------|
| 01 | task-01-xxx.md | {概要} | なし | pending |
| 02 | task-02-xxx.md | {概要} | 01 | pending |
| ... | ... | ... | ... | ... |

## コミット規約

各タスク完了時:
```
<type>: <description>

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

## 進捗

- [ ] ブランチ作成
- [ ] task-01 完了
- [ ] task-02 完了
- [ ] ...
- [ ] 全テスト通過
- [ ] mainへマージ
```

### Step 5: タスクファイルの作成

各タスクファイルは以下のテンプレートに従う：

```markdown
# タスク{番号}: {タスク名}

## 目的

{このタスクで何を達成するか}

## 背景

{なぜこのタスクが必要か、どういう文脈か}

## 対象ファイル

- `src/xxx.cs` - {変更内容}
- `src/yyy.cs` - {変更内容}

## 実装内容

- [ ] {具体的な実装項目1}
- [ ] {具体的な実装項目2}
- [ ] {具体的な実装項目3}

## テスト

- [ ] {テスト項目1}
- [ ] {テスト項目2}

## 完了条件

- {条件1}
- {条件2}
- 既存テストが通る

## 参考情報

- {参考になるファイルやドキュメント}

---

## 実行結果

<!-- /plan-run 実行時に自動追記される -->
```

### Step 6: RETROSPECTIVE.md の作成

```markdown
# 振り返り: {プラン名}

このファイルはプラン実行中に発生した問題点・改善点を記録する。
タスク実行後、気づいた点があれば随時追記すること。

---

## 問題点・課題

<!-- /plan-run 実行時に自動追記される -->

---

## 改善アイデア

### プランファイル関連

-

### サブエージェント関連

-

### CLAUDE.md関連

-

---

## 根本的な改善提案

<!-- LESSONS_LEARNED.md に昇格させるべき重要な学びをここに記録 -->

---

## 良かった点

-
```

### Step 7: 確認とブランチ作成

1. 作成したプランをユーザーに提示
2. 修正があれば反映
3. 承認されたら Git ブランチを作成

```bash
git checkout -b {branch-name}
```

## 出力形式

プラン作成完了後：

```
## プラン作成完了

- プラン名: {プラン名}
- ブランチ: {branch-name}
- タスク数: N件
- 場所: doc/plans/{branch-name}/

### タスク一覧
1. {task-01の概要}
2. {task-02の概要}
...

次のステップ:
- `/plan-run doc/plans/{branch-name}` でタスクを順次実行
- または手動で各タスクを実行
```

## 命名規約

- **ブランチ名**: `feature/{YYYY-MM}-{短い説明}` または `fix/{issue番号}-{短い説明}`
- **タスクファイル**: `task-{番号2桁}-{kebab-case名}.md`
- **タスク番号**: 01から連番

## 注意事項

- タスクは小さく分割する（1タスク = 1コミット程度）
- 依存関係を明確にし、並列実行可能なものは明記
- テスト項目を必ず含める
- 完了条件を具体的に書く
